



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.5.2">
    
    
      
        <title>Get started with Exekube - Exekube Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.aa3de92b.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.792431c1.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Fira Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../theme/extra.css">
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#getting-started-with-exekube" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
  Copyright (c) 2016-2018 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

  <!-- Top-level navigation -->
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <!-- Button to toggle drawer -->
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button"
            for="drawer"></label>
      </div>

      <!-- Header title -->
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title"
            data-md-component="title">
          
            
              <a href="/" class="md-header-nav__topic">
                Exekube Docs
              </a>
              <a href="" class="md-header-nav__topic">
                Get started with Exekube
              </a>
            
          
        </div>
      </div>

      <!-- Button to open search dialogue -->
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button"
                for="search"></label>

            <!-- Search interface -->
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>

      <!-- Repository containing source -->
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/exekube/exekube/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      exekube/exekube
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="Overview" class="md-tabs__link">
        Overview
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../introduction/what-is-exekube/" title="Introduction" class="md-tabs__link">
          Introduction
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="./" title="In Practice" class="md-tabs__link md-tabs__link--active">
          In Practice
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Exekube Docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/exekube/exekube/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      exekube/exekube
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/what-is-exekube/" title="What is Exekube?" class="md-nav__link">
      What is Exekube?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/exekube-vs-other/" title="Exekube in comparison" class="md-nav__link">
      Exekube in comparison
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/architecture/" title="Exekube's Architecture" class="md-nav__link">
      Exekube's Architecture
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      In Practice
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        In Practice
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Get started with Exekube
      </label>
    
    <a href="./" title="Get started with Exekube" class="md-nav__link md-nav__link--active">
      Get started with Exekube
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-well-build" title="What we'll build" class="md-nav__link">
    What we'll build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-0-prerequisites" title="Step 0: Prerequisites" class="md-nav__link">
    Step 0: Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-clone-the-git-repository" title="Step 1: Clone the Git repository" class="md-nav__link">
    Step 1: Clone the Git repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-configure-the-project-and-its-environments" title="Step 2: Configure the project and its environments" class="md-nav__link">
    Step 2: Configure the project and its environments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-initialize-dev-environment" title="Step 3: Initialize dev environment" class="md-nav__link">
    Step 3: Initialize dev environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-create-and-manage-cloud-infrastructure" title="Step 4: Create and manage cloud infrastructure" class="md-nav__link">
    Step 4: Create and manage cloud infrastructure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-create-and-manage-a-cluster-and-all-kubernetes-resources" title="Step 5: Create and manage a cluster and all Kubernetes resources" class="md-nav__link">
    Step 5: Create and manage a cluster and all Kubernetes resources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-optional-deploy-an-nginx-app" title="Step 6: (Optional) Deploy an nginx app" class="md-nav__link">
    Step 6: (Optional) Deploy an nginx app
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#making-upgrades" title="Making upgrades" class="md-nav__link">
    Making upgrades
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-clean-up" title="Step 7: Clean up" class="md-nav__link">
    Step 7: Clean up
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-next" title="What's next?" class="md-nav__link">
    What's next?
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../production-networking/" title="Configure production-grade networking" class="md-nav__link">
      Configure production-grade networking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../production-storage/" title="Configure production-grade storage" class="md-nav__link">
      Configure production-grade storage
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-well-build" title="What we'll build" class="md-nav__link">
    What we'll build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-0-prerequisites" title="Step 0: Prerequisites" class="md-nav__link">
    Step 0: Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-clone-the-git-repository" title="Step 1: Clone the Git repository" class="md-nav__link">
    Step 1: Clone the Git repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-configure-the-project-and-its-environments" title="Step 2: Configure the project and its environments" class="md-nav__link">
    Step 2: Configure the project and its environments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-initialize-dev-environment" title="Step 3: Initialize dev environment" class="md-nav__link">
    Step 3: Initialize dev environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-create-and-manage-cloud-infrastructure" title="Step 4: Create and manage cloud infrastructure" class="md-nav__link">
    Step 4: Create and manage cloud infrastructure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-create-and-manage-a-cluster-and-all-kubernetes-resources" title="Step 5: Create and manage a cluster and all Kubernetes resources" class="md-nav__link">
    Step 5: Create and manage a cluster and all Kubernetes resources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-optional-deploy-an-nginx-app" title="Step 6: (Optional) Deploy an nginx app" class="md-nav__link">
    Step 6: (Optional) Deploy an nginx app
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#making-upgrades" title="Making upgrades" class="md-nav__link">
    Making upgrades
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-clean-up" title="Step 7: Clean up" class="md-nav__link">
    Step 7: Clean up
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-next" title="What's next?" class="md-nav__link">
    What's next?
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/exekube/exekube/pulls/in-practice/getting-started.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="getting-started-with-exekube">Getting started with Exekube</h1>
<h2 id="what-well-build">What we'll build</h2>
<p>In this tutorial, we'll walk through the steps of creating a new Exekube project with a Kubernetes cluster in it:</p>
<p align="center">
  <img src="/images/screenshot.png" alt="The Kubernetes Dashboard"/>
</p>

<p>We'll then proceed to write code for a brand-new Helm chart (YAML + Go templates) and a Helm release (Terraform / HCL code) using the <a href="../../">helm-release module</a> from Exekube's <a href="../../">module library</a>:</p>
<p align="center">
  <img src="/images/nginx-app-screenshot.png" alt="The Nginx app release that uses a basic Helm chart"/>
</p>

<h2 id="step-0-prerequisites">Step 0: Prerequisites</h2>
<p>Before we begin, ensure that:</p>
<ul>
<li>You have a Google Account with access to an <a href="https://cloud.google.com/resource-manager/docs/quickstart-organizations">Organization resource</a></li>
<li>On your workstation, you have <a href="https://www.docker.com/community-edition">Docker Community Edition</a> installed</li>
</ul>
<h2 id="step-1-clone-the-git-repository">Step 1: Clone the Git repository</h2>
<ol>
<li>Clone the Git repo of the <a href="https://github.com/exekube/base-project">base-project</a>:</li>
</ol>
<div class="codehilite"><pre><span></span>git clone https://github.com/exekube/base-project
<span class="nb">cd</span> base-project
</pre></div>

<ol>
<li>Create an alias for your shell session:</li>
</ol>
<div class="codehilite"><pre><span></span><span class="nb">alias</span> <span class="nv">xk</span><span class="o">=</span><span class="s1">&#39;docker-compose run --rm xk&#39;</span>
</pre></div>

<details class="question"><summary>Why is this necessary?</summary><p>Exekube is distributed in a Docker image to save us from managing dependencies like <code class="codehilite">gcloud</code>, <code class="codehilite">terraform</code>, <code class="codehilite">terragrunt</code>, or <code class="codehilite">kubectl</code> on our workstation.</p><p>To create a Docker container from the image, we use Docker Compose. Check the <code class="codehilite">docker-compose.yaml</code> file in the root of our repository to see how the image is used.</p><p>The alias for our bash session is used to purely save us from typing <code class="codehilite">docker-compose run --rm exekube</code> every time we want to interact with the repository.</p></details><h2 id="step-2-configure-the-project-and-its-environments">Step 2: Configure the project and its environments</h2>
<details class="question"><summary>What is an environment?</summary><p>We will usually deploy our project into several <em>environments</em>, such as dev, stg, test, prod, etc.  Each environment corresponds to a separate <em>GCP project</em> with a globally unique ID. This allows us to fully isolate environments from each other.</p><p>Read more about GCP projects here: <a href="https://cloud.google.com/resource-manager/docs/creating-managing-projects">https://cloud.google.com/resource-manager/docs/creating-managing-projects</a></p></details><p>Set the <em>GCP project name base</em> in <code class="codehilite">docker-compose.yaml</code>:</p>
<div class="codehilite"><pre><span></span>services:
  xk:
    image: exekube/exekube:0.3.0-google
    working_dir: /project
    environment:
      # ...
<span class="gd">-     TF_VAR_project_id: ${ENV}-demo-apps-296e23</span>
<span class="gi">+     TF_VAR_project_id: ${ENV}-my-project-09345g</span>
</pre></div>

<h2 id="step-3-initialize-dev-environment">Step 3: Initialize dev environment</h2>
<p>Once we've set all the variables for each Terraform module, we can create the GCP project for our environment.</p>
<ol>
<li>
<p>Set shell variables:</p>
<div class="codehilite"><pre><span></span><span class="nb">export</span> <span class="nv">ENV</span><span class="o">=</span>dev
<span class="nb">export</span> <span class="nv">ORGANIZATION_ID</span><span class="o">=</span>&lt;YOUR-ORGANIZATION-ID&gt;
<span class="nb">export</span> <span class="nv">BILLING_ID</span><span class="o">=</span>&lt;YOUR-BILLING-ID&gt;
</pre></div>

</li>
<li>
<p>Log yourself into the Google Cloud Platform (follow on-screen instructions):</p>
<div class="codehilite"><pre><span></span>xk gcloud auth login
</pre></div>

</li>
<li>
<p>Run the <code class="codehilite">gcp-project-init</code> script:</p>
<div class="codehilite"><pre><span></span>xk gcp-project-init
</pre></div>

</li>
</ol>
<details class="question"><summary>What will this script do?</summary><p>The script will:</p><ul><li>Create a GCP project with the <code class="codehilite">$TF_VAR_project_id</code> ID we specified earlier</li><li>Create a GCP Service Account for use with Terraform, give it project owner permissions, and download its JSON-encoded key to the path at <code class="codehilite">$TF_VAR_serviceaccount_key</code></li><li>Create a GCS bucket for Terraform remote state, named <code class="codehilite">$TF_VAR_project_id</code>-tfstate</li></ul><p>Read the source code of the script here: <a href="https://github.com/exekube/exekube/blob/master/modules/gcp-project-init/gcp-project-init">https://github.com/exekube/exekube/blob/master/modules/gcp-project-init/gcp-project-init</a></p></details><h2 id="step-4-create-and-manage-cloud-infrastructure">Step 4: Create and manage cloud infrastructure</h2>
<p>Now that we have an empty GCP project set up for our environment, we will use Terraform and Terragrunt to manage all resources in it. Let's use the <code class="codehilite">gke-network</code> to create a VPC for our GKE cluster:</p>
<div class="codehilite"><pre><span></span><span class="c1"># Recursively looks for terraform.tfvars files in the subdirectories</span>
<span class="c1">#   of the specified path</span>
<span class="c1"># Imports and applies Terraform modules</span>
xk up live/dev/infra
</pre></div>

<p>Terraform modules in <code class="codehilite">live/&lt;ENV&gt;/infra</code> are "persistent", meaning that once we've created an environment, we can keep them in the "always created" state. Reasons for not cleaning them up for non-production environments:</p>
<ul>
<li>Networking services (VPN, DNS) often don't cost anything on cloud platforms</li>
<li>DNS records don't handle rapid changes well. It's more practical to have static IP addresses and DNS records</li>
</ul>
<h2 id="step-5-create-and-manage-a-cluster-and-all-kubernetes-resources">Step 5: Create and manage a cluster and all Kubernetes resources</h2>
<p>We can now create the cluster (gke-cluster module) and create all Kubernetes resources (helm-release modules) via one command:</p>
<div class="codehilite"><pre><span></span><span class="c1"># Since we don&#39;t specify path as an argument, it will use $TF_VAR_default_dir</span>
xk up
</pre></div>

<h2 id="step-6-optional-deploy-an-nginx-app">Step 6: (Optional) Deploy an nginx app</h2>
<p>Let's add a basic Terraform module and a Helm chart to deploy <em>myapp</em>, an nginx app, into our Kubernetes cluster:</p>
<ol>
<li>
<p>First, let's create the project module:
    <div class="codehilite"><pre><span></span>mkdir modules/myapp
cat &lt;&lt;<span class="s1">&#39;EOF&#39;</span> &gt; modules/myapp/main.tf
</pre></div>
    <div class="codehilite"><pre><span></span><span class="c1"># modules/myapp/main.tf</span>
<span class="err">terraform</span> <span class=" -Punctuation">{</span>
  <span class="err">backend</span> <span class="s2">&quot;gcs&quot;</span> <span class=" -Punctuation">{}</span>
<span class=" -Punctuation">}</span>

<span class="kr">variable</span> <span class="s">&quot;secrets_dir&quot;</span> <span class=" -Punctuation">{}</span>

<span class="kr">module</span> <span class="s">&quot;myapp&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">  source</span>           <span class="o">=</span> <span class="s2">&quot;/exekube-modules/helm-release&quot;</span>
<span class="na">  tiller_namespace</span> <span class="o">=</span> <span class="s2">&quot;kube-system&quot;</span>
<span class="na">  client_auth</span>      <span class="o">=</span> <span class="s2">&quot;${var.secrets_dir}/kube-system/helm-tls&quot;</span>

<span class="na">  release_name</span>      <span class="o">=</span> <span class="s2">&quot;myapp&quot;</span>
<span class="na">  release_namespace</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>

<span class="na">  chart_name</span> <span class="o">=</span> <span class="s2">&quot;nginx-app/&quot;</span>
<span class=" -Punctuation">}</span>
</pre></div>
    <div class="codehilite"><pre><span></span>EOF
</pre></div></p>
</li>
<li>
<p>Next, we will create a local Helm chart and release values for it:</p>
<div class="codehilite"><pre><span></span><span class="c1"># Create a brand-new Helm chart</span>
xk helm create nginx-app

<span class="c1"># Move the chart into modules/myapp</span>
mv nginx-app modules/myapp/

<span class="c1"># Create values.yaml for myapp Helm release</span>
cp modules/myapp/nginx-app/values.yaml modules/myapp/
</pre></div>

</li>
<li>
<p>Add the module into live/dev environment:
    <div class="codehilite"><pre><span></span>mkdir -p live/dev/k8s/default/myapp
</pre></div>
    <div class="codehilite"><pre><span></span>cat &lt;&lt;<span class="s1">&#39;EOF&#39;</span> &gt; live/dev/k8s/default/myapp/terraform.tfvars
</pre></div>
    <div class="codehilite"><pre><span></span><span class="c1"># ↓ Module metadata</span>
<span class="na">terragrunt</span> <span class="o">=</span> <span class=" -Punctuation">{</span>
  <span class="err">terraform</span> <span class=" -Punctuation">{</span>
<span class="na">    source</span> <span class="o">=</span> <span class="s2">&quot;/project/modules//myapp&quot;</span>
  <span class=" -Punctuation">}</span>

  <span class="err">dependencies</span> <span class=" -Punctuation">{</span>
<span class="na">    paths</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s2">&quot;../../kube-system/helm-initializer&quot;</span><span class="p">,</span>
    <span class="p">]</span>
  <span class=" -Punctuation">}</span>

<span class="na">  include</span> <span class="o">=</span> <span class=" -Punctuation">{</span>
<span class="na">    path</span> <span class="o">=</span> <span class="s2">&quot;${find_in_parent_folders()}&quot;</span>
  <span class=" -Punctuation">}</span>
<span class=" -Punctuation">}</span><span class="c1"></span>

<span class="c1"># ↓ Module configuration (empty means all default)</span>
</pre></div>
    <div class="codehilite"><pre><span></span>EOF
</pre></div></p>
</li>
<li>
<p>Update your cluster:
    <div class="codehilite"><pre><span></span>xk up
</pre></div></p>
</li>
<li>
<p>Create a TLS tunnel (<code class="codehilite">kubectl proxy</code>) to our <code class="codehilite"><span class="n">localhost</span><span class="o">:</span><span class="mi">8001</span></code>:
    <div class="codehilite"><pre><span></span>docker-compose up -d
</pre></div>
    Go to <a href="http://localhost:8001/api/v1/namespaces/default/services/myapp-nginx-app:80/proxy/">http://localhost:8001/api/v1/namespaces/default/services/myapp-nginx-app:80/proxy/</a></p>
<p><p align="center">
  <img src="/images/nginx-app-screenshot.png" alt="The Nginx app release that uses a basic Helm chart"/>
</p></p>
</li>
</ol>
<h3 id="making-upgrades">Making upgrades</h3>
<p>All configuration is declarative, so just modify any module's variables and run <code class="codehilite">xk up</code> again to upgrade the cluster's state.</p>
<p>You can also create, upgrade, or destroy single modules or namespaces by specifying a path as an argument to <code class="codehilite">xk up</code> or <code class="codehilite">xk destroy</code>:</p>
<div class="codehilite"><pre><span></span><span class="c1"># Use bash completion 👍</span>
<span class="c1">#</span>
<span class="c1"># Apply only one module</span>
xk up live/dev/k8s/default/myapp/
<span class="c1"># Destroy only one module</span>
xk down live/dev/k8s/default/myapp/

<span class="c1"># Apply all modules in default directory</span>
xk up live/dev/k8s/default/
<span class="c1"># Destroy all modules in default directory</span>
xk down live/dev/k8s/default/
</pre></div>

<h2 id="step-7-clean-up">Step 7: Clean up</h2>
<ol>
<li>
<p>When you are done with your dev environment, run this command to destroy the GKE cluster and all Kubernetes / Helm resources (the important parts):
    <div class="codehilite"><pre><span></span><span class="c1"># Again, since we don&#39;t specify path as an argument, it will</span>
<span class="c1">#   use $TF_VAR_default_dir</span>
xk down
</pre></div></p>
<p>These resources are highly ephemeral in non-production environments, meanining that you can <code class="codehilite">xk up</code> and <code class="codehilite">xk down</code> several times per day / per hour. Google Compute Engine (GCE) running instances (Kubernetes worker nodes) are quite expensive (especially for more intensive workloads), so we want to only keep them running when needed.</p>
</li>
<li>
<p>Clean up networking resources (⚠️ not recommended)
    <div class="codehilite"><pre><span></span>xk down live/dev/infra
</pre></div>
    These resources (except reserving a static IP address) are free on Google Cloud Platform, so we recommend you keep them always created.</p>
</li>
<li>
<p>Clean up the GCP project (⚠️ not recommended)</p>
<p>There's no automation for destroying a GCP project and starting over. Billing-enabled projects are subject to strict quotas if you are using the Google Cloud Platform free trial, so we recommend to purge projects (delete resources manually) instead deleting the project itself.</p>
</li>
</ol>
<h2 id="whats-next">What's next?</h2>
<ul>
<li>
<p>Configure production-grade networking: <a href="http://docs.exekube.com/in-practice/production-networking/">http://docs.exekube.com/in-practice/production-networking/</a></p>
</li>
<li>
<p>Configure production-grade storage: <a href="http://docs.exekube.com/in-practice/production-storage/">http://docs.exekube.com/in-practice/production-storage/</a></p>
</li>
<li>
<p>Check out <a href="../../">this pull request on GitHub</a> to see how to deploy the Guestbook app from <a href="../../">kubernetes/examples</a></p>
</li>
<li>
<p>Take a look at Exekube example projects: <a href="https://docs.exekube.com/introduction/what-is-exekube#examples">https://docs.exekube.com/introduction/what-is-exekube#examples</a></p>
</li>
</ul>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        

<!-- Application footer -->
<footer class="md-footer">

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 Ilya Sotkov
          </div>
        
      </div>

      <!-- Social links -->
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.f041762f.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
        <script src="../../theme/assets/javascripts/application.js"></script>
      
    
    
      
    
  </body>
</html>